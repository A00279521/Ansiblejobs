- hosts: localhost
  connection: local
  become: true
  tasks:
  - name: install nginx
    apt:
      name: nginx
      state: present
      update_cache: true

  - name: Copy nginx file over
    copy:
      src: nginx.conf
      dest: /etc/nginx/nginx.conf
    register: nginx_config

  - name: Restart nginx if needed
    service:
      name: nginx
      state: restarted
    when: nginx_config.changed == true

  - name: printing nginx info to console
    debug:
     msg: "{{ nginx_config }}"


  - name: nginxbefore
    debug: 
       var: nginx_config.path

  - name: nginxafter
    debug: 
       var: nginx_config.after
  
  - name: fail if nginx file has been copied over 
    debug: 
    when: nginx_config.after == nginx_config.before